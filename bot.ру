import asyncio
import logging
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import Message
import re

# –¢–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (—É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã)
TOKEN = "8513701961:AAGD_y-bnme0R1334zQFvU0FBcu0DjOYa44"
CHANNEL_ID = -1003378716687
ADMIN_ID = 851130471

bot = Bot(token=TOKEN)
dp = Dispatcher()

logging.basicConfig(level=logging.INFO)

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ (–∫—Ä–∞—Å–∏–≤–æ —Å —ç–º–æ–¥–∑–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π)
def format_prognosis(text: str) -> str:
    lines = [line.strip() for line in text.strip().split('\n') if line.strip()]
    formatted = "‚öΩ **–ï–ñ–ï–î–ù–ï–í–ù–´–ô –ü–†–û–ì–ù–û–ó –ù–ê –°–ü–û–†–¢**\n\n"
    
    for line in lines:
        if re.match(r'^(‚öΩ|–ü1|–ü2|–•|–û–ó|–¢–ë|–¢–ú|–£–≥–ª–æ–≤—ã–µ|–ñ–ö)', line, re.IGNORECASE):
            formatted += f"‚Ä¢ **{line}**\n"
        elif re.search(r'\d+\.\d{2}', line):
            formatted += f"{line}\n"
        else:
            formatted += f"{line}\n"
    
    formatted += "\nüìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:** –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∞ ‚Äî 72% (–Ω–∞ –æ—Å–Ω–æ–≤–µ 50+ –º–∞—Ç—á–µ–π)\n"
    formatted += "üí∞ –°—Ç–∞–≤—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ! –ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è –∑–∞ –±–æ–ª—å—à–µ –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏. #—Ñ—É—Ç–±–æ–ª #–ø—Ä–æ–≥–Ω–æ–∑—ã"
    
    return formatted

# /start ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
@dp.message(Command("start"))
async def start_handler(message: Message):
    if message.from_user.id == ADMIN_ID:
        await message.answer("üöÄ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n–ö–∏–¥–∞–π –ø—Ä–æ–≥–Ω–æ–∑ —Ç–µ–∫—Å—Ç–æ–º –≤ –ª–∏—á–∫—É ‚Äî —è –æ–ø—É–±–ª–∏–∫—É—é –≤ –∫–∞–Ω–∞–ª.\n\n**–ü—Ä–∏–º–µ—Ä:**\n‚öΩ –ú–∞–Ω –°–∏—Ç–∏ ‚Äî –õ–∏–≤–µ—Ä–ø—É–ª—å\n–ü1 ‚Üí 2.10\n–û–±–µ –∑–∞–±—å—é—Ç ‚Äî –î–∞ ‚Üí 1.75\n–¢–æ—Ç–∞–ª –≥–æ–ª–æ–≤ –ë 2.5 ‚Üí 1.92\n–£–≥–ª–æ–≤—ã–µ –ë 10.5 ‚Üí 1.88\n–ñ–ö –ë 4.5 ‚Üí 1.87")
    else:
        await message.answer("üëã –ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –±–æ—Ç —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏ –Ω–∞ —Å–ø–æ—Ä—Ç. –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª: t.me/+—Ç–≤–æ–π_–∫–∞–Ω–∞–ª (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π).")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –æ—Ç –∞–¥–º–∏–Ω–∞
@dp.message(lambda message: message.from_user.id == ADMIN_ID and not message.text.startswith('/'))
async def handle_prognosis(message: Message):
    formatted_text = format_prognosis(message.text)
    
    try:
        await bot.send_message(chat_id=CHANNEL_ID, text=formatted_text, parse_mode="Markdown")
        await message.answer("‚úÖ –ü—Ä–æ–≥–Ω–æ–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –≤ –∫–∞–Ω–∞–ª! –ü—Ä–æ–≤–µ—Ä—å —Ç–∞–º.")
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞: {str(e)}\n(–ü—Ä–æ–≤–µ—Ä—å, –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ –±–æ—Ç –≤ –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –ø–æ—Å—Ç–∏–Ω–≥).")

# /test ‚Äî –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
@dp.message(Command("test"))
async def test(message: Message):
    if message.from_user.id == ADMIN_ID:
        await message.answer("‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª! –ë–æ—Ç –æ–Ω–ª–∞–π–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
async def main():
    print("üöÄ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
